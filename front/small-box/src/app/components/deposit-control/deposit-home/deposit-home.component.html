<body>
    <app-navbar></app-navbar>



    <div class="container-flex">
        <div class="row">
            <div class="col-md-8"></div>
            <div class="col-md-4">
                <h1>Deposito seleccionado:
                    <small class="text-danger" *ngIf="!selectedDepositBol">Ninguno</small>
                    <small class="text-primary" *ngIf="selectedDepositBol">{{selectedDepositStr}}</small>
                    <button (click)="openDialogDepositSelection(depositSelectionTemplate)"
                        class="btn btn-sm mt-1 ms-3 text-white">Seleccionar</button>
                    <!-- <button (click)="deleteCurrentDepositSelected()"
                    class="btn btn-sm mt-1 ms-3 text-white">Delete</button> -->
                </h1>
            </div>
        </div>

        <div class="row">

            <div class="col text-center mt-2">

            </div>
        </div>
        <div class="row mt-5 ms-3">
            <div class="col-md-3">
                <h5>ORDEN DE COMPRA</h5>
                <hr class="my-4">
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3">
                <h5>SUMINISTRO</h5>
                <hr class="my-4">
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3">
                <h5 class="d-inline">DEPOSITO</h5>
                <button (click)="openDialogDepositCreation(createDepositTemplate)"
                    class="btn btn-sm ms-5 mb-3 text-white">Crear deposito</button>
                <hr class="my-4">
            </div>
        </div>
        <div class="row mt-3 ms-3">

            <div class="col-md-3 mt-1">
                <!-- Purchase order jumbotron -->
                <div class="jumbotron ms-1">
                    <div>
                        <p class="d-inline display-4">SUBIR</p>
                        <a (click)="uploadPurchaseOrderFile()" class="btn btn-sm ms-3 " role="button">-</a>
                        <input id="uploadInput" class="w-50 ms-2" type="file" (change)="selectFile($event)" />
                    </div>
                    <div id="orderItem" class="mt-1">
                        <p class="d-inline display-4">VER</p>
                        <a (click)="openDialogPurchaseOrderList(purchaseOrderListTemplate)" class="btn btn-sm ms-3"
                            role="button">-</a>
                    </div>
                    <p class="lead">
                        <hr class="my-4">
                </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3 mt-1">
                <!-- Supply jumbotron -->
                <div class="jumbotron  ms-1">
                    <div>
                        <p class="d-inline display-4">SUBIR</p>
                        <a (click)="uploadSupplyFile()" class="btn btn-sm ms-3 " role="button">-</a>
                        <input id="uploadInput" class="w-50 ms-2" type="file" (change)="selectFile($event)" />
                    </div>
                    <div id="orderItem" class="mt-1">
                        <p class="d-inline display-4">VER</p>
                        <a (click)="openDialogSupplyList(supplyListTemplate)" class="btn btn-sm ms-3"
                            role="button">-</a>
                    </div>
                    <p class="lead">
                        <hr class="my-4">
                </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3 mt-1">
                <!-- Deposit jumbotron -->
                <div class="jumbotron  ms-1">
                    <p class="d-inline display-4">VER STOCK</p>
                    <a (click)="openDepositControlListTemplate(depositControlListTemplate)" class="btn btn-sm ms-3 "
                        role="button">-</a>
                    <p class="lead">
                        <hr class="my-4">
                </div>
            </div>
        </div>

    </div>
</body>
<ng-template #depositControlListTemplate>
    <button id="closeButton" (click)="onCloseDepositControlListTemplate()" class="btn btn-sm text-white">X</button>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-6 ms-2">
            <!-- Deposit control table -->
            <h2 *ngIf="selectedDepositBol"> DEPOSITO: {{selectedDepositStr}}</h2>
            <p class="lead">
                <hr class="my-4">
            <table class="table table-flex table-bordered h-75">
                <thead>
                    <tr>
                        <th scope="col">CODIGO</th>
                        <th scope="col">U.MEDIDA</th>
                        <th scope="col">DESCRIPCION</th>
                        <th scope="col">P.UNITARIO</th>
                        <th scope="col">TOTAL</th>
                        <th scope="col">CANTIDAD</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of depositControlDtos">
                        <td>{{item.itemCode}}</td>
                        <td>{{item.measureUnit}}</td>
                        <td>{{item.itemName}}</td>
                        <td>{{item.itemUnitPrice | currency: '$': 'symbol'}}</td>
                        <td>{{item.itemTotalPrice | currency: '$': 'symbol'}}</td>
                        <td *ngIf="item.quantity>=10" class="text-success fw-bold">{{item.quantity}}</td>
                        <td *ngIf="item.quantity<10" class="text-danger fw-bold">{{item.quantity}}</td>
                    </tr>

                </tbody>
            </table>

        </div>
    </div>
</ng-template>
<ng-template #purchaseOrderTableTemplate>
    <button id="closeButton" (click)="onClosePurchaseOrderTableTemplate()" class="btn btn-sm text-white">X</button>
    <div class="row mt-1">
        <div class="col-md-4"></div>
        <div class="col-md-4">
            <h2 class="d-inline">ORDEN DE COMPRA NUMERO: </h2>
            <h2 class="d-inline text-danger">{{purchaseOrderDto.orderNumber}} </h2>
        </div>
        <!-- Purchase order table -->
        <div class="col-md-1"></div>
        <div class="col-md-2">
            <h3>FECHA: {{purchaseOrderDto.date |date: 'dd-MM-yyyy'}}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">

        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3>UNIDAD EJECUTORA: {{purchaseOrderDto.executerUnit}}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3>DEPENDENCIA: {{purchaseOrderDto.dependency}}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3>FUENTE DE FINANCIAMIENTO: {{purchaseOrderDto.financingSource}}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3 class="d-inline">TOTAL: </h3>
            <h3 class="d-inline text-danger">{{purchaseOrderDto.purchaseOrderTotal | currency: '$': 'symbol'}}</h3>
        </div>
    </div>
    <div class="row mt-1">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <table class="table table-flex table-bordered">
                <thead>
                    <tr>
                        <th scope="col">CODIGO</th>
                        <th scope="col">CAT PROG</th>
                        <th scope="col">CANTIDAD</th>
                        <th scope="col">U.MEDIDA</th>
                        <th scope="col">DESCRIPCION</th>
                        <th scope="col">P.UNITARIO</th>
                        <th scope="col">TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of purchaseOrderItemDtos">
                        <td>{{item.code}}</td>
                        <td>{{item.programaticCat}}</td>
                        <td>{{item.quantity}}</td>
                        <td>{{item.measureUnit}}</td>
                        <td>{{item.itemDetail}}</td>
                        <td>{{item.unitCost | currency: '$': 'symbol'}}</td>
                        <td class="text-primary">{{item.totalEstimatedCost | currency: '$': 'symbol'}}</td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
</ng-template>
<ng-template #supplyTableTemplate>
    <button id="closeButton" (click)="onCloseSupplyTableTemplate()" class="btn btn-sm text-white">X</button>
    <div class="row mt-1">
        <div class="col-md-5"></div>
        <div class="col-md-5">
            <h2 class="d-inline">SUMINISTRO NUMERO: </h2>
            <h2 class="d-inline text-danger">{{supplyDto.supplyNumber}} </h2>

        </div>
        <!-- Purchase order table -->
        <div class="col-md-2">
            <h3>FECHA: {{supplyDto.date |date: 'dd-MM-yyyy' }}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3>UNIDAD EJECUTORA:</h3>
        </div>
    </div>

    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3>DEPENDENCIA SOLICITANTE: {{supplyDto.dependencyApplicant}}</h3>
        </div>
    </div>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <h3 class="d-inline">TOTAL:</h3>
            <h3 class="d-inline text-danger">{{supplyDto.estimatedTotalCost| currency: '$': 'symbol'}}</h3>
        </div>
    </div>
    <div class="row mt-1">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <table class="table table-flex table-bordered">
                <thead>
                    <tr>
                        <th scope="col">CODIGO</th>
                        <th scope="col">CAT PROG</th>
                        <th scope="col">CANTIDAD</th>
                        <th scope="col">U.MEDIDA</th>
                        <th scope="col">DESCRIPCION</th>
                        <th scope="col">P.UNITARIO</th>
                        <th scope="col">TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of supplyItemDtos">
                        <td>{{item.code}}</td>
                        <td>{{item.programaticCat}}</td>
                        <td>{{item.quantity}}</td>
                        <td>{{item.measureUnit}}</td>
                        <td>{{item.itemDetail}}</td>
                        <td>{{item.unitCost | currency: '$': 'symbol'}}</td>
                        <td class="text-primary">{{item.totalEstimatedCost | currency: '$': 'symbol'}}</td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
</ng-template>

<ng-template #purchaseOrderListTemplate>
    <div class="container-flex">


        <button id="closeButton" (click)="onClosepurchaseOrderListTemplate()" class="btn btn-sm text-white">X</button>



        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4">
                <h2 class="text-center">ORDENES DE COMPRA</h2>
                <p class="lead">
                    <hr class="my-4">
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <table class="table table-flex table-bordered h-75">
                    <thead>
                        <tr>
                            <th scope="col">FECHA</th>
                            <th scope="col">NUMERO</th>
                            <th scope="col">UNIDAD EJECUTORA</th>
                            <th scope="col">DEPENDENCIA</th>
                            <th scope="col">TOTAL</th>
                            <th>VER ITEMS</th>
                            <th>A DEPOSITO</th>
                            <th>CARGADO</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let order of purchaseOrderDtos">
                            <td>{{order.date |date: 'dd-MM-yyyy'}}</td>
                            <td>{{order.orderNumber}}</td>
                            <td>{{order.executerUnit}}</td>
                            <td>{{order.dependency}}</td>
                            <td class="text-danger">{{order.purchaseOrderTotal | currency: '$': 'symbol'}}</td>
                            <td class="text-center"><button
                                    (click)="openDialogPurchaseOrderItemsList(purchaseOrderItemsListTemplate,order.id)"
                                    class="btn btn-sm  text-danger">-</button></td>
                            <td class="text-center">
                                <button *ngIf="order.loadedToDeposit"
                                    (click)="confirmDepositLoad(order.id,order.loadedToDeposit,order.orderNumber)"
                                    class="btn btn-sm text-danger" disabled>-</button>
                                <button *ngIf="!order.loadedToDeposit"
                                    (click)="confirmDepositLoad(order.id,order.loadedToDeposit,order.orderNumber)"
                                    class="btn btn-sm text-danger">-</button>
                            </td>
                            <td *ngIf="order.loadedToDeposit" class="text-success text-center">
                                {{order.loadedToDepositName}}</td>
                            <td *ngIf="!order.loadedToDeposit" class="text-danger  text-center">NO</td>
                        </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #purchaseOrderItemsListTemplate>
    <button id="closeButton" (click)="onClosepurchaseOrderItemListTemplate()" class="btn btn-sm text-white">X</button>
    <h2>ITEMS</h2>
    <table class="table-sm table-bordered h-75">
        <thead>
            <tr>
                <th scope="col">CODIGO</th>
                <th scope="col">CAT.PROG.</th>
                <th scope="col">CANTIDAD</th>
                <th scope="col">U.MEDIDA</th>
                <th scope="col">DESCRIPCION</th>
                <th scope="col">P.UNITARIO</th>
                <th scope="col">TOTAL</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let orderItem of purchaseOrderItemDtosListShow">
                <td>{{orderItem.code}}</td>
                <td>{{orderItem.programaticCat}}</td>
                <td>{{orderItem.quantity}}</td>
                <td>{{orderItem.measureUnit}}</td>
                <td>{{orderItem.itemDetail}}</td>
                <td>{{orderItem.unitCost | currency: '$': 'symbol'}}</td>
                <td>{{orderItem.totalEstimatedCost | currency: '$': 'symbol'}}</td>

            </tr>

        </tbody>


    </table>

</ng-template>

<ng-template #supplyListTemplate>
    <button id="closeButton" (click)="onCloseSupplyListTemplate()" class="btn btn-sm text-white">X</button>
    <h2 class="text-center">SUMINISTROS</h2>
    <table class="table-sm table-bordered h-75">
        <thead>
            <tr>
                <th scope="col">FECHA</th>
                <th scope="col">NUMERO</th>
                <th scope="col">SOLICITANTE</th>
                <th scope="col">COSTO TOTAL ESTIMADO</th>
                <th scope="col">VER ITEMS</th>
                <th scope="col">COMPARAR</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let supply of suppliesDto">
                <td>{{supply.date |date: 'dd-MM-yyyy'}}</td>
                <td>{{supply.supplyNumber}}</td>
                <td>{{supply.dependencyApplicant}}</td>
                <td>{{supply.estimatedTotalCost | currency: '$': 'symbol'}}</td>
                <td class="text-center"><button (click)="openDialogSuppliesItemList(supplyItemsListTemplate,supply.id)"
                        class="btn btn-lg  text-danger"></button></td>
                <td class="text-center"><button
                        (click)="openSupplyCorrectionNoteDialog(supplyCorrectionNoteTemplate,supply.id)"
                        class="btn btn-lg text-danger"></button></td>
            </tr>

        </tbody>


    </table>
</ng-template>
<ng-template #supplyItemsListTemplate>
    <button id="closeButton" (click)="onCloseSupplyItemListTemplate()" class="btn btn-sm text-white">X</button>
    <h2>ITEMS</h2>
    <table class="table-sm table-bordered h-75">
        <thead>
            <tr>
                <th scope="col">CODIGO</th>
                <th scope="col">CAT.PROG.</th>
                <th scope="col">CANTIDAD</th>
                <th scope="col">U.MEDIDA</th>
                <th scope="col">DESCRIPCION</th>
                <th scope="col">P.UNITARIO</th>
                <th scope="col">TOTAL</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let supplyItem of supplyItemsDtoListShow">
                <td>{{supplyItem.code}}</td>
                <td>{{supplyItem.programaticCat}}</td>
                <td>{{supplyItem.quantity}}</td>
                <td>{{supplyItem.measureUnit}}</td>
                <td>{{supplyItem.itemDetail}}</td>
                <td>{{supplyItem.unitCost | currency: '$': 'symbol'}}</td>
                <td>{{supplyItem.totalEstimatedCost | currency: '$': 'symbol'}}</td>

            </tr>

        </tbody>


    </table>
</ng-template>
<ng-template #purchaseOrderToDepositTemplate>
    <button id="closeButton" (click)="onCloseOrderToDepositTemplate()" class="btn btn-sm text-white">X</button>
    <table class="table-sm table-bordered h-75">
        <thead>
            <tr>
                <th scope="col">ESTADO</th>
                <th scope="col">DESCRIPCION</th>
                <th scope="col">U.MEDIDA</th>
                <th scope="col">CANTIDAD</th>

            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let report of depositReport">
                <td class="text-primary">{{report.depositItemStatus}}</td>
                <td>{{report.depositItemName}}</td>
                <td>{{report.depositItemMeasureUnit}}</td>
                <td *ngIf="report.depositItemQuantity>=10" class="text-success">{{report.depositItemQuantity}}</td>
                <td *ngIf="report.depositItemQuantity<10" class="text-danger">{{report.depositItemQuantity}}</td>

            </tr>

        </tbody>


    </table>
</ng-template>
<ng-template #supplyCorrectionNoteTemplate>
    <button id="closeButton" (click)="onCloseSupplyCorrectionNoteTemplate()" class="btn btn-sm text-white">X</button>
    <div id="correction" class="container-flex">
        <div class="row mt-2">
            <div class="col-md-3">

            </div>

            <div class="col-md-6">
                <h2>DETALLE DE COMPARACION DE SUMINISTRO CON STOCK</h2>

            </div>

            <div class="col-md-3">
                <div>
                    <h4> Fecha: {{now |date: 'dd-MM-yyyy'}}</h4>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div clasS="col-md-6">
                <div>
                    <h4 class="d-inline">DEPOSITO: </h4>
                    <h1 class="d-inline"> {{supplyCorrectionNote.depositName}}</h1>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-6">
                <div>
                    <h4 class="d-inline"> SUMINISTRO NUMERO:</h4>
                    <h1 class="d-inline"> {{supplyCorrectionNote.supplyNumber}}</h1>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-6">
                <div>
                    <h4 class="d-inline"> UNIDAD EJECUTORA:</h4>
                    <h1 class="d-inline"> {{supplyCorrectionNote.from.toUpperCase()}}</h1>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-6">
                <div>
                    <h4 class="d-inline">DEPENDENCIA SOLICITANTE:</h4>
                    <h1 class="d-inline"> {{supplyCorrectionNote.to.toUpperCase()}}</h1>
                </div>
            </div>
            <p class="lead">
                <hr class="my-4">
        </div>
        <div class="row mt-2" *ngFor="let item of supplyCorrectionNote.supplyReport">
            <div class="col-md-2"></div>
            <div class="col-md-3">
                <div class="mt-2">
                    <p>ITEM SUMINISTRO:</p>
                    <h1 class="d-inline">CODIGO:</h1><small class="ms-2"> {{item.supplyItemCode}}</small>
                </div>

                <div>
                    <h1 class="d-inline"> DETALLE:</h1><small class="ms-2"> {{item.supplyItemDetail}}</small>
                </div>
                <div>
                    <h1 class="d-inline"> U.MEDIDA:</h1><small class="ms-2"> {{item.supplyItemMeasureUnit}}</small>
                </div>
                <div>
                    <h1 class="d-inline"> CANTIDAD:</h1> <small class="ms-2">{{item.supplyItemQuantity}}</small>
                </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-3">
                <div class="mt-2">
                    <p>ITEM DEPOSITO:</p>
                    <h1 class="d-inline">CODIGO:</h1><small class="ms-2"> {{item.depositItemCode}} </small>
                </div>

                <div>
                    <h1 class="d-inline"> DETALLE:</h1><small class="ms-2"> {{item.depositItemDetail}}</small>
                </div>
                <div>
                    <h1 class="d-inline"> U.MEDIDA:</h1><small class="ms-2"> {{item.depositItemMeasureUnit}}</small>
                </div>
                <div>
                    <h1 class="d-inline">CANTIDAD :</h1> <small class="ms-2">{{item.depositItemQuantity}}</small>
                </div>
                <div *ngIf="item.depositQuantityLeft>0">
                    <h1 class="d-inline">SOBRANTE :</h1> <small
                        class="ms-2 text-success">{{item.depositQuantityLeft}}</small>

                </div>
                <div *ngIf="item.depositQuantityLeft<0">
                    <h1 class="d-inline">FALTANTE :</h1> <small
                        class="ms-2 text-danger">{{item.depositQuantityLeft.toString().replace("-","")}}</small>
                </div>
            </div>
            <p class="lead">
                <hr class="my-4">
        </div>
    </div>
</ng-template>
<ng-template #createDepositTemplate>
    <button id="closeButton" (click)="onCloseDepositCreationTemplate()" class="btn btn-sm text-white">X</button>
    <div class="container-flex">
        <div class="row mt-5">
            <div class="col-md-4"></div>
            <div class="col-md-4">
                <form [formGroup]="depositFormbuilder" class="d-inline form-group text-center fw-bold">
                    <div class="form-group">
                        <label for="name" class="form-label">Nombre</label>
                        <input type="text" class="form-control" formControlName="name" id="name">
                        <div *ngIf="name.invalid && (name.dirty || name.touched)" class="text-danger">
                            <div *ngIf="name.errors?.['required']">
                                Falta el nomber...
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="streetName" class="form-label">Calle</label>
                        <input type="streetName" class="form-control" formControlName="streetName" id="streetName">
                        <div *ngIf="streetName.invalid && (streetName.dirty || streetName.touched)" class="text-danger">
                            <div *ngIf="streetName.errors?.['required']">
                                Falta la calle...
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="houseNumber" class="form-label">Numero</label>
                        <input type="houseNumber" class="form-control" formControlName="houseNumber" id="houseNumber">
                        <div *ngIf="houseNumber.invalid && (houseNumber.dirty || houseNumber.touched)"
                            class="text-danger">
                            <div *ngIf="houseNumber.errors?.['required']">
                                Falta el numero de calle...
                            </div>
                        </div>
                        <button class="rounded-pill btn btn-sm text-center text-white mt-2"
                            (click)="createDeposit()">Guardar</button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</ng-template>
<ng-template #depositSelectionTemplate>
    <div class="container-flex">
        <div class="row mt-3">
            <div class="col">
                <h5 class="text-center">SELECCIONAR DEPOSTIO</h5>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-md-5"></div>
            <div class="col-md-4">
                <table class="table-sm table-bordered h-75">
                    <thead>
                        <tr>
                            <th scope="col">DEPOSITO</th>
                            <th scope="col">SELECCIONAR</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="text-center" *ngFor="let deposit of depositDtos">
                            <td class="text-primary">{{deposit.name}}</td>
                            <td (click)="setCurrentDeposit(deposit.id)" class="btn btn-sm text-primary">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</ng-template>